<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Review events</title>
</head>
<body>
  <h1>Review and complete events</h1>

  <form th:object="${reviewForm}" method="post" th:action="@{/export}">
    <div>
      <label>Canvas context code</label><br/>
      <input type="text" th:field="*{contextCode}" size="40" />
    </div>
    
    <div style="margin-top: 12px;">
      <label>
        <input type="checkbox" th:field="*{exportToMyCalendar}" />
        Export to my personal Canvas calendar (fallback if course export is blocked)
      </label>
    </div>


    <hr/>

    <div th:if="${#lists.isEmpty(reviewForm.events)}">
      <p>No reservations found in TimeEdit response.</p>
    </div>

    <table th:if="${!#lists.isEmpty(reviewForm.events)}" border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr>
          <th>Title</th>
          <th>Start</th>
          <th>End</th>
          <th>Location</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="ev, stat : *{events}">
          <!-- hidden fields so we keep original data for later export -->
          <input type="hidden" th:field="*{events[__${stat.index}__].sourceId}" />
          <input type="hidden" th:field="*{events[__${stat.index}__].title}" />
          <input type="hidden" th:field="*{events[__${stat.index}__].startIso}" />
          <input type="hidden" th:field="*{events[__${stat.index}__].endIso}" />

          <td th:text="*{events[__${stat.index}__].title}">Title</td>
          <td th:text="${#strings.replace(reviewForm.events[__${stat.index}__].startIso, 'T', ' ')}">Start</td>
          <td th:text="${#strings.replace(reviewForm.events[__${stat.index}__].endIso, 'T', ' ')}">End</td>

          <td>
            <input type="text" th:field="*{events[__${stat.index}__].location}" size="30" />
          </td>
          <td>
            <textarea th:field="*{events[__${stat.index}__].description}" rows="4" cols="50"></textarea>
          </td>
        </tr>
      </tbody>
    </table>
    <div style="margin-top: 16px;">
      <button type="submit">Export to Canvas</button>
    </div>
  </form>
</body>
</html>
